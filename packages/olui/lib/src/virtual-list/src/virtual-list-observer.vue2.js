"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),H=require("./props.js"),g=require("../../_utils/props/index.js"),_=e.defineComponent({name:"ol-infinite1"}),x=e.defineComponent({..._,props:H.default,setup(p){const c=p,t=e.reactive({start:0,end:10,scrollOffset:0,cacheData:[]}),f=e.ref(),D=e.computed(()=>{const{style:a,height:n,width:r}=c,o=g.isString(a)?JSON.parse(a):{...a};return{height:`${n}px`,width:g.isNumber(r)?`${r}px`:r,...o}}),y=e.computed(()=>({height:`${e.unref(b)}px`,width:"100%"})),v=e.computed(()=>({willChange:"transform",transform:`translateY(${t.scrollOffset}px)`})),u=e.computed(()=>(console.log(c.data.length),c.data.length)),b=e.computed(()=>c.dynamic?h(e.unref(u)):e.unref(u)*c.itemHeight),d=e.computed(()=>Math.ceil(c.height/c.itemHeight)),m=e.computed(()=>c.data.slice(t.start,t.end)),O=a=>{console.log(11111);const{scrollTop:n}=a.target;if(t.scrollOffset===n)return;const{cache:r,dynamic:o,itemHeight:s}=c,i=Math.max(1,r);let l=o?S(n):Math.floor(n/s);const w=Math.max(0,Math.min(e.unref(u),l+e.unref(d)+i));l>i&&(l=l-i);const M=o?h(l):n-n%s;Object.assign(t,{start:l,end:w,scrollOffset:M})},S=(a=0)=>{let n=0,r=t.cacheData.length-1;for(;n<=r;){const o=n+Math.floor((r-n)/2),s=h(o),i=h(o+1);if(s<=a&&a<=i)return o;i<a?n=o+1:i>a&&(r=o-1)}return Math.min(e.unref(u)-e.unref(d),Math.floor(a/c.itemHeight))},h=a=>{const n=t.cacheData.length-1;return Object.hasOwn(t.cacheData,a)?t.cacheData[a].top:Object.hasOwn(t.cacheData,a-1)?t.cacheData[a-1].bottom:a>n?t.cacheData[n].bottom+Math.max(0,a-t.cacheData[n].index)*c.itemHeight:a*c.itemHeight};return e.onUpdated(()=>{if(!c.dynamic)return;[...f.value.children||[]].forEach((n,r)=>{const o=n.getBoundingClientRect().height,s=t.start+r;t.cacheData[s].height!==o&&(t.cacheData[s].height=o,t.cacheData[s].top=h(s),t.cacheData[s].bottom=t.cacheData[s].top+t.cacheData[s].height)})}),e.watchEffect(()=>{m.value.forEach((a,n)=>{const r=t.start+n;Object.hasOwn(t.cacheData,r)||(t.cacheData[r]={top:r*c.itemHeight,height:c.itemHeight,bottom:(r+1)*c.itemHeight,index:r})})}),(a,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["base-virtual-wrapper",a.className]),ref:"wrapperRef",style:e.normalizeStyle(e.unref(D)),onScroll:O},[e.createElementVNode("div",{class:"base-virtual-inner",ref:"innerRef",style:e.normalizeStyle(e.unref(y))},[e.createElementVNode("div",{class:"base-virtual-list",style:e.normalizeStyle(e.unref(v)),ref_key:"virtualListRef",ref:f},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(m),(r,o)=>(e.openBlock(),e.createElementBlock("div",{key:o+t.start},[e.renderSlot(a.$slots,"default",{item:r},void 0,!0)]))),128))],4)],4)],38))}});exports.default=x;
